#!/usr/bin/env bash

readonly mode="$1"

set -e -o pipefail -o nounset

dsh_hosts() {
    local hosts file
    file="$HOME/.dsh/group/all"
    if [ -f "$file" ]; then
        hosts=$(grep -vE '^#' "$file")
        echo "$hosts"
    fi
}

my_hosts() {
    local hosts file
    file="$HOME/.ssh/hosts"
    if [ -f "$file" ]; then
        hosts=$(grep -vE '^#' "$file")
        echo "$hosts"
    fi
}

known_hosts() {
    local hosts file
    file="$HOME/.ssh/known_hosts"
    if [ -f "$file" ]; then
        hosts=$(awk '{print $1}' "$file" | grep -v ^\| | cut -d, -f 1 | sed -e 's/\[//g' | sed -e 's/\]//g' | cut -d: -f1 | grep -v ssh-rsa)
        echo "$hosts"
    fi
}

bash_history() {
    local hosts file
    file="$HOME/.bash_history"
    if [ -f "$file" ]; then
        hosts=$(grep -E "^host|^dig|^drill|^ping" "$file" | awk '{print $NF}')
        echo "$hosts"
    fi
}

main() {
    case "$mode" in
        "dsh")
            dsh_hosts | sort -u
        ;;

        "hosts")
            known_hosts | sort -u
        ;;

        "alfred")
            alfred
        ;;

        "ssh")
            (
                dsh_hosts
                known_hosts
            ) | sort -u
        ;;

        *)
            (
                dsh_hosts
                known_hosts
                bash_history
            ) | sort -u
        ;;
    esac

    return 0
}
main
